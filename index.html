<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>スマホでHACCP 臨時飲食店向け 衛生管理記録アプリ</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0369a1"/>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- ★ 追加：外部CSS -->
  <link rel="stylesheet" href="./style.css">
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="container">
    <div style="position:absolute;top:1.5rem;left:1.5rem;font-size:.75rem;color:#9ca3af;" class="no-print" id="version-chip"></div>
    <div class="no-print" style="position:absolute;top:1rem;right:1rem;display:flex;gap:.5rem;">
      <button id="manual-update-btn" class="btn btn-sky" style="padding:.5rem 1rem;font-size:.875rem;">アプリを更新</button>
      <button id="clear-data-btn-header" class="btn btn-red" style="padding:.5rem 1rem;font-size:.875rem;">全データクリア</button>
    </div>

    <header class="no-print" style="padding-top:3rem;">
      <h1>スマホでHACCP 臨時飲食店向け 衛生管理記録アプリ</h1>
    </header>

    <div id="announcement-banner" class="no-print mb-6">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg id="announcement-icon" class="icon" xmlns="http://www.w3.org/2000/svg" fill="none"
               viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
                  d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.852l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
          </svg>
        </div>
        <div class="ml-3 flex-1">
          <p id="announcement-text" class="text-content"></p>
        </div>
      </div>
    </div>

    <p class="section-title no-print" style="border-bottom:none;text-align:center;margin-bottom:2rem;">
      このアプリでは、お店の情報を入力するだけで衛生管理計画を自動で作成し、記録を作成することができます。
    </p>

    <main id="main-content" class="space-y-8">
      <section id="step1" class="card no-print">
        <h2 class="section-title">ステップ1：お店の情報を入力</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label for="restaurant-name" class="form-label">店名（屋号）</label>
            <input type="text" id="restaurant-name" class="form-input" placeholder="例：〇〇商店">
          </div>
          <div>
            <label for="plan-preparer" class="form-label">計画作成者 氏名</label>
            <input type="text" id="plan-preparer" class="form-input" placeholder="例：山田 太郎">
          </div>
          <div>
            <label for="plan-date" class="form-label">計画作成年月日</label>
            <input type="date" id="plan-date" class="form-input">
          </div>
        </div>
      </section>

      <section id="step2" class="card no-print">
        <h2 class="section-title">ステップ2：取り扱い品目を入力</h2>
        <p class="text-sm text-gray-600 mb-4">
          品目名を入力すると、自動でグループに分類します。
          <strong style="color:#0369a1;">改行すると複数品目を入力できます。</strong>
        </p>
        <textarea id="menu-items" class="form-textarea"
                  placeholder="例：&#10;焼きそば&#10;かき氷&#10;ペットボトル飲料"></textarea>
      </section>

      <div id="generate-plan-btn-container" class="text-center no-print">
        <button id="generate-plan-btn" class="btn btn-sky">品目を分類する</button>
      </div>

      <section id="classification-review-section" class="hidden card no-print">
        <h2 class="section-title">ステップ3：分類の確認・修正</h2>
        <p class="text-sm text-gray-600 mb-4">
          各品目を自動で分類しました。内容を確認し、必要であれば修正してください。
        </p>
        <div id="review-list" class="space-y-3"></div>
        <div class="text-center mt-6 flex flex-col sm:flex-row justify-center gap-4">
          <button id="back-to-step2-btn" class="btn btn-gray">品目を修正する</button>
          <button id="confirm-classification-btn" class="btn btn-teal">この分類で計画を作成する</button>
        </div>
      </section>

      <div id="plan-output" class="hidden">
        <div id="plan-area" class="printable">
          <div class="card space-y-10">
            <header class="text-center border-b-2 border-gray-200 pb-4">
              <h1 class="text-3xl font-bold text-gray-800">衛生管理計画</h1>
              <div class="mt-4">
                <p style="font-size:1.25rem;font-weight:500;color:#6b7280;">
                  店名（屋号）：<span id="output-restaurant-name"
                    style="font-size:1.875rem;font-weight:700;color:#1f2937;"></span>
                </p>
                <p style="font-size:1.25rem;font-weight:500;color:#4b5563;margin-top:.5rem;">業種：臨時飲食店営業</p>
              </div>
              <div class="text-right mt-4 text-sm">
                <p>作成年月日: <span id="output-plan-date"></span></p>
                <p>作成者氏名: <span id="output-plan-preparer"></span></p>
              </div>
            </header>

            <section>
              <h2 class="text-2xl font-bold text-sky-700 mb-4 pb-2 border-b-2 border-sky-200">
                1. 一般衛生管理のポイント
              </h2>
              <div id="general-hygiene-points" class="space-y-6 text-sm sm:text-base"></div>
            </section>

            <section>
              <h2 class="text-2xl font-bold text-sky-700 mb-4 pb-2 border-b-2 border-sky-200">
                2. 重要管理のポイント（分類別）
              </h2>
              <div id="critical-points-content" class="space-y-6"></div>
            </section>
          </div>
        </div>

        <div id="record-area" class="card mt-8 printable">
          <header class="text-center border-b-2 border-gray-200 pb-4">
            <h1 class="text-3xl font-bold text-gray-800">衛生管理記録</h1>
            <div id="record-print-header" class="hidden"></div>
          </header>
          <div class="overflow-x-auto mt-4">
            <table id="record-table" class="record-table">
              <thead id="record-table-head"></thead>
              <tbody id="record-table-body"></tbody>
            </table>
          </div>
          <div class="text-center mt-6 no-print space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="add-record-btn" class="btn btn-sky btn-add-record">新しい営業日の記録を追加</button>
            <button id="start-review-btn" class="btn btn-teal btn-add-record">今月の振り返りを行う</button>
          </div>
        </div>

        <div id="print-buttons-container" class="buttons-grid mt-8 no-print">
          <button id="modify-plan-btn" class="btn btn-gray">計画を修正する</button>
          <button id="save-plan-btn" class="btn btn-indigo">この計画を保存</button>
          <button id="pdf-output-btn" class="btn btn-orange">PDF保存（スマホ用）</button>
          <button id="print-plan-btn" class="btn btn-sky">計画を印刷</button>
          <button id="print-record-btn" class="btn btn-sky">全記録を印刷</button>
          <button id="print-all-btn" class="btn btn-sky">計画とまとめて印刷</button>
          <button id="export-excel-btn" class="btn btn-green">全記録をExcel出力</button>
          <button id="export-json-btn" class="btn btn-indigo" style="grid-column: 1 / 2;">全データ引継ぎ(エクスポート)</button>
          <button id="import-json-btn" class="btn btn-red" style="grid-column: 2 / 3;">データ復元(インポート)</button>
        </div>
      </div>
    </main>
  </div>

  <div id="confirm-modal" class="modal-overlay hidden">
    <div class="card max-w-sm w-full">
      <h3 id="confirm-title" class="text-lg font-bold"></h3>
      <p id="confirm-message" class="mt-2 text-sm text-gray-600"></p>
      <div class="mt-6 flex justify-end gap-4">
        <button id="modal-cancel-btn" class="btn btn-gray">キャンセル</button>
        <button id="modal-confirm-btn" class="btn btn-red">OK</button>
      </div>
    </div>
  </div>

  <div id="prompt-modal" class="modal-overlay hidden">
    <div class="card max-w-sm w-full">
      <h3 id="prompt-title" class="text-lg font-bold"></h3>
      <div class="mt-4">
        <label id="prompt-label" for="prompt-input" class="form-label"></label>
        <input type="text" id="prompt-input" class="form-input">
      </div>
      <div class="mt-6 flex justify-end gap-4">
        <button id="prompt-cancel-btn" class="btn btn-gray">キャンセル</button>
        <button id="prompt-confirm-btn" class="btn btn-sky">OK</button>
      </div>
    </div>
  </div>

  <div id="date-prompt-modal" class="modal-overlay hidden">
    <div class="card max-w-sm w-full">
      <h3 id="date-prompt-title" class="text-lg font-bold"></h3>
      <div class="mt-4">
        <label id="date-prompt-label" for="date-prompt-input" class="form-label"></label>
        <input type="date" id="date-prompt-input" class="form-input">
      </div>
      <div class="mt-6 flex justify-end gap-4">
        <button id="date-prompt-cancel-btn" class="btn btn-gray">キャンセル</button>
        <button id="date-prompt-confirm-btn" class="btn btn-sky">OK</button>
      </div>
    </div>
  </div>

  <div id="review-modal" class="modal-overlay hidden">
    <div class="modal-card">
      <div class="modal-header">月次振り返り</div>
      <div class="modal-body">
        <form id="review-form">
          <div class="review-q">
            <p class="review-q-title">Q1 毎営業日、正しく記録をつけることができましたか？</p>
            <div class="radio-group">
              <label class="radio-label"><input type="radio" name="q1" value="yes" checked> はい</label>
              <label class="radio-label"><input type="radio" name="q1" value="no"> いいえ</label>
            </div>
            <div id="q1-followup" class="review-sub-q hidden">
              <label class="form-label">今後忘れずに正しい記録をつけるためにどのようにしますか？</label>
              <textarea name="q1-detail" class="form-textarea h-16"></textarea>
            </div>
          </div>

          <div class="review-q">
            <p class="review-q-title">Q2 衛生上問題があったところはどこですか？</p>
            <p class="text-xs text-gray-600 mb-2">（例：否に○が多かった、クレームが多かった、作業量超過など）</p>
            <div class="review-sub-q">
              <label class="form-label">問題があったポイント</label>
              <textarea name="q2-point" class="form-textarea h-16 mb-2"></textarea>
              <label class="form-label">その理由</label>
              <textarea name="q2-reason" class="form-textarea h-16 mb-2"></textarea>
              <label class="form-label">改善方法</label>
              <textarea name="q2-improve" class="form-textarea h-16"></textarea>
            </div>
          </div>

          <div class="review-q">
            <p class="review-q-title">Q3 従業員が代わりましたか？</p>
            <div class="radio-group">
              <label class="radio-label"><input type="radio" name="q3" value="yes"> はい</label>
              <label class="radio-label"><input type="radio" name="q3" value="no" checked> いいえ</label>
            </div>
            <div id="q3-followup" class="review-sub-q hidden">
              <p class="font-semibold mb-2">衛生管理計画の説明は行いましたか？</p>
              <div class="radio-group mb-2">
                <label class="radio-label"><input type="radio" name="q3-explained" value="yes"> はい</label>
                <label class="radio-label ml-4">
                  実施日: <input type="date" name="q3-date" class="form-input inline-block w-auto py-1">
                </label>
              </div>
              <div class="radio-group mb-4">
                <label class="radio-label"><input type="radio" name="q3-explained" value="no"> いいえ</label>
              </div>
              <p class="font-semibold mb-2">説明を行った従業員は計画を理解して衛生管理を実施していますか？</p>
              <div class="radio-group">
                <label class="radio-label"><input type="radio" name="q3-understood" value="yes"> はい</label>
                <label class="radio-label"><input type="radio" name="q3-understood" value="no"> いいえ</label>
              </div>
            </div>
          </div>

          <div class="review-q">
            <p class="review-q-title">Q4 メニュー、原材料、納入業者を変更しましたか？</p>
            <div class="radio-group">
              <label class="radio-label"><input type="radio" name="q4" value="yes"> はい</label>
              <label class="radio-label"><input type="radio" name="q4" value="no" checked> いいえ</label>
            </div>
            <div id="q4-followup" class="review-sub-q hidden">
              <p class="font-semibold mb-2">衛生管理計画を見直しましたか？</p>
              <div class="mb-4">
                <div class="radio-group mb-2">
                  <label class="radio-label"><input type="radio" name="q4-reviewed" value="yes"> はい</label>
                  <label class="radio-label ml-4">
                    見直し日: <input type="date" name="q4-date" class="form-input inline-block w-auto py-1">
                  </label>
                </div>
                <div class="pl-6 mb-2">
                  <label class="form-label text-sm">どのように変更しましたか？</label>
                  <textarea name="q4-change" class="form-textarea h-12"></textarea>
                </div>
              </div>
              <div>
                <div class="radio-group mb-2">
                  <label class="radio-label"><input type="radio" name="q4-reviewed" value="no"> いいえ</label>
                </div>
                <div class="pl-6">
                  <label class="form-label text-sm">見直さなくて良い理由は何ですか？</label>
                  <textarea name="q4-reason" class="form-textarea h-12"></textarea>
                </div>
              </div>
            </div>
          </div>

          <div class="review-q">
            <p class="review-q-title">Q5 新しい設備・器具を購入しましたか？</p>
            <div class="radio-group">
              <label class="radio-label"><input type="radio" name="q5" value="yes"> はい</label>
              <label class="radio-label"><input type="radio" name="q5" value="no" checked> いいえ</label>
            </div>
            <div id="q5-followup" class="review-sub-q hidden">
              <p class="font-semibold mb-2">衛生管理計画を見直しましたか？</p>
              <div class="mb-4">
                <div class="radio-group mb-2">
                  <label class="radio-label"><input type="radio" name="q5-reviewed" value="yes"> はい</label>
                  <label class="radio-label ml-4">
                    見直し日: <input type="date" name="q5-date" class="form-input inline-block w-auto py-1">
                  </label>
                </div>
                <div class="pl-6 mb-2">
                  <label class="form-label text-sm">どのように変更しましたか？</label>
                  <textarea name="q5-change" class="form-textarea h-12"></textarea>
                </div>
              </div>
              <div>
                <div class="radio-group mb-2">
                  <label class="radio-label"><input type="radio" name="q5-reviewed" value="no"> いいえ</label>
                </div>
                <div class="pl-6">
                  <label class="form-label text-sm">見直さなくて良い理由は何ですか？</label>
                  <textarea name="q5-reason" class="form-textarea h-12"></textarea>
                </div>
              </div>
            </div>
          </div>

        </form>
      </div>
      <div class="modal-footer">
        <button id="review-cancel-btn" class="btn btn-gray">キャンセル</button>
        <button id="review-save-btn" class="btn btn-teal">振り返りを記録する</button>
      </div>
    </div>
  </div>

  <!-- ★ 追加：外部JS -->
  <script src="./main.js"></script>
</body>
</html>

